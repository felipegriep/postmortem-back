# Postmortem — Incidente #42: Erro 500 no checkout

**Severidade:** SEV-2 • **Status:** RESOLVED  
**Início:** 2025-11-06 20:15 (America/Sao_Paulo) • **Fim:** 2025-11-06 21:05 • **Duração:** 50m  
**Impacto (resumo):** Checkout indisponível para ~8% dos usuários por 26 min.

## Métricas
- **MTTA:** 12m • **MTTR:** 50m
- **Eventos:** 6 • **Houve comunicação?** ✅
- **Score:** 80/100
    - Timeline: 20 • Impacto: 20 • 5 Porquês: 0 • Causa+Fatores: 20 • Ações: 20 • Comunicação: 0
    - Checks: ✅ Min. eventos • ✅ Impacto • ❌ 5 Porquês • ✅ Causa+Fatores • ✅ Ações (corretiva+preventiva) • ❌ Comunicação

## Timeline
| Quando                  | Tipo                | Ator   | Descrição                                 |
|-------------------------|---------------------|--------|--------------------------------------------|
| 2025-11-06 20:15        | DETECTED            | Pager  | Erro 5xx acima do limiar                   |
| 2025-11-06 20:27        | INVESTIGATION_START | Ana    | Triagem inicial                            |
| 2025-11-06 20:33        | MITIGATION_STARTED  | Bruno  | Rolling restart do serviço Auth            |
| 2025-11-06 20:39        | COMMUNICATION       | Ana    | Aviso no Status Page                       |
| 2025-11-06 20:45        | MITIGATION_ENDED    | Bruno  | Latência normalizada                       |
| 2025-11-06 21:05        | RESOLVED            | Time   | Incidente encerrado                        |

## Análise de Causa
**5 Porquês**
1. Por que erro 500? → Falha no Auth sob pico de refresh token
2. Por que falhou? → Rotação de chave não propagou…
3. …  
   **Causa raiz:** Lacuna na cobertura de alerta de rotação de chaves.  
   **Fatores contribuintes:** Falta de canary; mudança fora da janela.

## Ações
### Corretivas
| Descrição                                         | Owner | Due (local)        | Status | Fechada em         | SLA          |
|---------------------------------------------------|-------|--------------------|--------|--------------------|--------------|
| Criar alerta de rotação de chave (Prometheus) [evidência](https://…) | Ana   | 2025-11-12 18:00 | DONE   | 2025-11-12 17:10 | **No prazo** |
### Preventivas
| Descrição                                         | Owner | Due (local)        | Status | Fechada em         | SLA          |
|---------------------------------------------------|-------|--------------------|--------|--------------------|--------------|
| Adicionar canary na rotação de chaves             | Bruno | 2025-11-15 12:00 | DOING  | —                  | *Atrasada ●* |